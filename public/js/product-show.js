function refreshPrice(t,e,n){var r=$("input[name=product_id]").val();$("#a_product-price").html('<div class="m-loader m-loader--success" style="width: 30px; display: inline-block;"></div>'),$.ajax({type:"POST",url:"/refreshPrice/"+r,data:{mainAttributeValues:t,products:e,extraAttributeValues:n},statusCode:{200:function(t){t=$.parseJSON(t),totalExtraCost=parseInt(t.totalExtraCost);var e=parseInt(t.cost),n=parseInt(t.costForCustomer);n<e?$("#a_product-price").html("قیمت محصول: <strike>"+e+"</strike> تومان <br>قیمت برای مشتری: "+n+" تومان "):$("#a_product-price").html("قیمت محصول: "+n+" تومان "),t.productWarning&&Swal({title:"توجه!",text:t.productWarning,type:"warning",confirmButtonText:"بستن"})},403:function(t){window.location.replace("/403")},401:function(t){window.location.replace("/403")},404:function(t){window.location.replace("/404")},422:function(t){console.log(t)},500:function(t){console.log(t.responseText)},503:function(t){}}})}function getMainAttributeStates(){var t=$('input[type=hidden][name="attribute[]"]').map(function(){if($(this).val())return $(this).val()}).get(),e=$('select[name="attribute[]"]').map(function(){if($(this).val())return $(this).val()}).get(),n=$('input[type=checkbox][name="attribute[]"]:checked').map(function(){if($(this).val())return $(this).val()}).get(),r=$.merge($.merge(e,n),t);return r.filter(function(t,e){return r.indexOf(t)==e})}function getExtraAttributeStates(){var t=$('select[name="extraAttribute[]"]').map(function(){if($(this).val())return $(this).val()}).get(),e=$('input[type=checkbox][name="extraAttribute[]"]:checked').map(function(){if($(this).val())return $(this).val()}).get(),n=$.merge(t,e);return n.filter(function(t,e){return n.indexOf(t)==e})}function getProductSelectValues(){return $('input[type=checkbox][name="products[]"]:checked').map(function(){if($(this).val())return $(this).val()}).get()}$(function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":window.Laravel.csrfToken}})});var totalExtraCost=0,bonDiscount=0,productDiscount=0;$(document).on("ifChanged change",".attribute",function(){refreshPrice(getMainAttributeStates(),[],[])}),$(document).on("ifChanged change",".extraAttribute",function(){refreshPrice([],[],getExtraAttributeStates())}),$(document).on("ifChanged switchChange.bootstrapSwitch",".product",function(){refreshPrice([],getProductSelectValues(),[])});var ProductSwitch=function(){function t(e,n){var r=$("input[name='products[]'].product.hasParent_"+e);for(var a in r)if(!isNaN(a)){var i=$(r[a]).hasClass("hasChildren"),c=r[a].defaultValue;$(r[a]).prop("checked",n),i&&t(c,n)}}function e(){var t=$("input[name='products[]'].product");for(var e in t)if(!isNaN(e)){var r=$(t[e]).hasClass("hasChildren"),a=t[e].defaultValue,i={allChildIsChecked:!0,allChildIsNotChecked:!0,counter:0},c=n(a,i);r&&(c.allChildIsChecked?$(t[e]).prop("checked",!0):$(t[e]).prop("checked",!1))}}function n(t,e){var r=$("input[name='products[]'].product.hasParent_"+t);for(var a in r)if(!isNaN(a)){var i=r[a].defaultValue,c=$("input[name='products[]'][value='"+i+"'].product"),u=c.hasClass("hasChildren"),o=c.length,s=c.prop("checked");o>0&&!0!==s&&(e.allChildIsChecked=!1),!0===s&&(e.allChildIsNotChecked=!1),u?(e.counter++,e=n(i,e)):e.allChildIsNotChecked=!1}return e}function r(){return n($("input[name='products[]'].product")[0].defaultValue,{allChildIsChecked:!0,allChildIsNotChecked:!0,counter:0}).counter}function a(t,n){for(var r=0;r<t;r++)e();n()}return{init:function(){return r()},updateSelectedProductsStatus:function(t,e){a(t,e)},changeChildCheckStatus:function(e,n){t(e,n)}}}();jQuery(document).ready(function(){var t=ProductSwitch.init(),e=function(){refreshPrice([],getProductSelectValues(),[])};$(document).on("change","input[name='products[]'].product",function(){var n=this.defaultValue;$(this).hasClass("hasChildren")&&ProductSwitch.changeChildCheckStatus(n,$(this).prop("checked")),ProductSwitch.updateSelectedProductsStatus(t,e)})});
