var BootstrapSwitch={init:function(){$("[data-switch=true]").bootstrapSwitch()}};jQuery(document).ready(function(){BootstrapSwitch.init()});var CheckoutPaymentUi=function(){function e(){return parseInt($("#invoiceInfo-totalCost").html())}function n(e){isNaN(e)||(console.log("setFinalCost: ",e),$(".finalPriceValue").html(e.toLocaleString("fa")),$("#invoiceInfo-totalCost").html(parseInt(e)))}function t(){return $("#invoiceInfo-couponCode").val()}function o(){var e=$('input[type="radio"][name="radioPaymentType"]:checked'),n=e.val();$(".PaymentType").slideUp(),$("#PaymentType-"+n).slideDown();var t=e.data("btntext");$(".btnSubmitOrder").html(t)}function a(){$("#hasntDonate").bootstrapSwitch("state",!1),$(".face-sad").fadeOut(0),$(".face-happy").fadeIn(0),$(".visibleInDonate").css({visibility:"visible"})}function r(){$("#hasntDonate").bootstrapSwitch("state",!0),$(".face-sad").fadeIn(0),$(".face-happy").fadeOut(0),$(".visibleInDonate").css({visibility:"hidden"})}function i(){return!$("#hasntDonate").prop("checked")}function u(t){n(e()+1e3*parseInt(t))}function c(){if(i()){a();var e=5;if(v)return!1;mApp.block(".addDonateWarper",{type:"loader",state:"info"}),$.ajax({type:"POST",url:$("#addDonateUrl").val(),data:{mode:"normal"},success:function(n){v=!0,n.error?503===n.error.code?a():(r(),e=0,toastr.warning("مشکلی رخ داده است. مجدد سعی کنید.")):(a(),u(e)),mApp.unblock(".addDonateWarper"),v=!1},error:function(n,t,o){v=!0,r(),e=0,toastr.warning("مشکلی رخ داده است. مجدد سعی کنید."),mApp.unblock(".addDonateWarper"),v=!1}})}else{r();if(v)return!1;mApp.block(".addDonateWarper",{type:"loader",state:"info"}),$.ajax({type:"DELETE",url:$("#removeDonateUrl").val(),data:{mode:"normal"},success:function(e){v=!0,e.error?(a(),toastr.warning("مشکلی رخ داده است. مجدد سعی کنید.")):(r(),u(-5)),mApp.unblock(".addDonateWarper"),v=!1},error:function(e,n,t){v=!0,a(),toastr.warning("مشکلی رخ داده است. مجدد سعی کنید."),mApp.unblock(".addDonateWarper"),v=!1}})}}function s(){$(".discountCodeValueWarperCover").fadeOut();var e=$("#discountCodeValue"),n=$("#btnSaveDiscountCodeValue");e.prop("disabled",!1),n.prop("disabled",!1),e.prop("readonly",!1),n.prop("readonly",!1)}function d(){$(".discountCodeValueWarperCover").fadeIn();var e=$("#discountCodeValue"),n=$("#btnSaveDiscountCodeValue");e.prop("disabled",!0),n.prop("disabled",!0),e.prop("readonly",!0),n.prop("readonly",!0),e.val("")}function l(){$("#discountCodeValue").val(t()),$("#hasntDiscountCode").prop("checked")?(d(),f(!1)):s()}function p(){var e=$("#discountCodeValue").val();return 0===e.trim().length?(toastr.warning("مقداری برای کد تخفیف وارد نشده است."),!1):!h&&(mApp.block(".discountCodeValueWarper, .hasntDiscountCodeWraper",{type:"loader",state:"info"}),void $.ajax({type:"POST",url:$("#OrderController-submitCoupon").val(),data:{code:e},success:function(e){if(e.error){$("#btnRemoveDiscountCodeValue").fadeOut(0),$("#btnSaveDiscountCodeValue").fadeIn();toastr.warning("کد وارد شده معتبر نیست.")}else{$(".couponReportWarper").fadeIn();var t=" کپن تخفیف  <strong>"+e.coupon.name+"</strong>  ("+e.coupon.code+")  با "+e.coupon.discount;"percentage"===e.coupon.discountType.name?t+="% تخفیف برای سفارش شما ثبت شده است.":"cost"===e.coupon.discountType.name&&(t+=" تومان تخفیف برای سفارش شما ثبت شد. "),$(".couponReport").html(t),$("#btnSaveDiscountCodeValue").fadeOut(0),$("#btnRemoveDiscountCodeValue").fadeIn(),n(e.price.final),m(e.notIncludedProductsInCoupon),toastr.success("کد تخفیف شما ثبت شد.")}mApp.unblock(".discountCodeValueWarper, .hasntDiscountCodeWraper")},error:function(e,n,t){var o=e.status,a="";a=500==o?"خطایی رخ داده است.":"کد وارد شده معتبر نیست",toastr.warning(a),mApp.unblock(".discountCodeValueWarper, .hasntDiscountCodeWraper")}}))}function f(e){if(h)return!1;mApp.block(".discountCodeValueWarper, .hasntDiscountCodeWraper",{type:"loader",state:"info"}),$.ajax({type:"GET",url:$("#OrderController-removeCoupon").val(),data:{},success:function(t){if(t.error){if(!0===e){toastr.error("مشکلی در حذف کد تخفیف رخ داده است."),$("#btnSaveDiscountCodeValue").fadeOut(0),$("#btnRemoveDiscountCodeValue").fadeIn()}}else $(".couponReportWarper").fadeOut(),$("#btnRemoveDiscountCodeValue").fadeOut(0),$("#btnSaveDiscountCodeValue").fadeIn(),$("#discountCodeValue").val(""),n(t.price.final),m([]),!0===e&&toastr.success("کد تخفیف شما حذف شد.");mApp.unblock(".discountCodeValueWarper, .hasntDiscountCodeWraper")},error:function(e,n,t){mApp.unblock(".discountCodeValueWarper, .hasntDiscountCodeWraper")}})}function m(e){var n="";if(void 0!==e&&null!==e&&""!==e&&e.length>0){n+='<div class="m-alert m-alert--icon m-alert--icon-solid m-alert--outline alert alert-warning alert-dismissible fade show" role="alert">\n  <div class="m-alert__icon">\n    <i class="flaticon-exclamation"></i>\n    <span></span>\n  </div>\n  <div class="m-alert__text">\n    <strong>توجه!</strong> کد تخفیف وارد شده شامل محصولات زیر نمی شود:\n  </div>\n  <div class="m-alert__close">\n  </div>\n</div><div class="row">';for(var t in e){n+='<div class="col">  <div class="alert alert-accent alert-dismissible fade show m-alert m-alert--square m-alert--air notIncludedProductsInCoupon" role="alert">\n    <div>'+e[t].name+"    </div>  </div></div>"}n+="</div>"}$(".notIncludedProductsInCouponReportArea").html(n)}var v=!1,h=!1;return{refreshUi:function(){v=!0,h=!0,o(),c(),l(),v=!1,h=!1},refreshUiBasedOnHasntDiscountCodeStatus:function(){l()},refreshUiBasedOnPaymentType:function(){o()},refreshUiBasedOnDonateStatus:function(e){c()},attachCoupon:function(){p()},detachCoupon:function(e){f(e)},PrintnotIncludedProductsInCoupon:function(e){m(e)}}}(),lockDonateAjaxForSliderInit=!0;jQuery(document).ready(function(){var e=document.getElementById("m_nouislider_1_input"),n=document.getElementById("m_nouislider_1");CheckoutPaymentUi.refreshUi(),$(document).on("click","#btnSaveDiscountCodeValue",function(){CheckoutPaymentUi.attachCoupon()}),$(document).on("click","#btnRemoveDiscountCodeValue",function(){CheckoutPaymentUi.detachCoupon(!0)}),$(document).on("change",'input[type="radio"][name="radioPaymentType"]',function(){CheckoutPaymentUi.refreshUiBasedOnPaymentType()}),$(document).on("switchChange.bootstrapSwitch","#hasntDiscountCode",function(){CheckoutPaymentUi.refreshUiBasedOnHasntDiscountCodeStatus()}),$(document).on("switchChange.bootstrapSwitch","#hasntDonate",function(e){CheckoutPaymentUi.refreshUiBasedOnDonateStatus($("#m_nouislider_1_input").val())}),noUiSlider.create(n,{start:[5],connect:[!0,!1],step:1,range:{min:[1],max:[50]},format:wNumb({decimals:0})}),n.noUiSlider.on("update",function(n,t){e.value=n[t],lockDonateAjaxForSliderInit||CheckoutPaymentUi.refreshUiBasedOnDonateStatus(e.value),lockDonateAjaxForSliderInit=!1}),e.addEventListener("change",function(){n.noUiSlider.set(this.value)})});
