var BootstrapSwitch={init:function(){$("[data-switch=true]").bootstrapSwitch()}};jQuery(document).ready(function(){BootstrapSwitch.init()});var CheckoutPaymentUi=function(){var e=!1,n=!1;function t(e){isNaN(e)||(console.log("setFinalCost: ",e),$(".finalPriceValue").html(e.toLocaleString("fa")),$("#invoiceInfo-totalCost").html(parseInt(e)))}function o(){var e=$('input[type="radio"][name="radioPaymentType"]:checked'),n=e.val();$(".PaymentType").slideUp(),$("#PaymentType-"+n).slideDown();var t=e.data("btntext");$(".btnSubmitOrder").html(t)}function a(){$("#hasntDonate").bootstrapSwitch("state",!1),$(".face-sad").fadeOut(0),$(".face-happy").fadeIn(0),$(".visibleInDonate").css({visibility:"visible"})}function r(){$("#hasntDonate").bootstrapSwitch("state",!0),$(".face-sad").fadeIn(0),$(".face-happy").fadeOut(0),$(".visibleInDonate").css({visibility:"hidden"})}function i(e){t(parseInt($("#invoiceInfo-totalCost").html())+1e3*parseInt(e))}function c(){if($("#hasntDonate").prop("checked")){r();if(e)return!1;mApp.block(".addDonateWarper",{type:"loader",state:"info"}),$.ajax({type:"DELETE",url:$("#removeDonateUrl").val(),data:{mode:"normal"},success:function(n){e=!0,n.error?(a(),toastr.warning("مشکلی رخ داده است. مجدد سعی کنید.")):(r(),i(-5)),mApp.unblock(".addDonateWarper"),e=!1},error:function(n,t,o){e=!0,a(),toastr.warning("مشکلی رخ داده است. مجدد سعی کنید."),mApp.unblock(".addDonateWarper"),e=!1}})}else{a();var n=5;if(e)return!1;mApp.block(".addDonateWarper",{type:"loader",state:"info"}),$.ajax({type:"POST",url:$("#addDonateUrl").val(),data:{mode:"normal"},success:function(t){e=!0,t.error?503===t.error.code?a():(r(),n=0,toastr.warning("مشکلی رخ داده است. مجدد سعی کنید.")):(a(),i(n)),mApp.unblock(".addDonateWarper"),e=!1},error:function(t,o,a){e=!0,r(),n=0,toastr.warning("مشکلی رخ داده است. مجدد سعی کنید."),mApp.unblock(".addDonateWarper"),e=!1}})}}function u(){$("#discountCodeValue").val($("#invoiceInfo-couponCode").val()),$("#hasntDiscountCode").prop("checked")?(!function(){$(".discountCodeValueWarperCover").fadeIn();var e=$("#discountCodeValue"),n=$("#btnSaveDiscountCodeValue");e.prop("disabled",!0),n.prop("disabled",!0),e.prop("readonly",!0),n.prop("readonly",!0),e.val("")}(),s(!1)):function(){$(".discountCodeValueWarperCover").fadeOut();var e=$("#discountCodeValue"),n=$("#btnSaveDiscountCodeValue");e.prop("disabled",!1),n.prop("disabled",!1),e.prop("readonly",!1),n.prop("readonly",!1)}()}function s(e){if(n)return!1;mApp.block(".discountCodeValueWarper, .hasntDiscountCodeWraper",{type:"loader",state:"info"}),$.ajax({type:"GET",url:$("#OrderController-removeCoupon").val(),data:{},success:function(n){if(n.error){if(!0===e){toastr.error("مشکلی در حذف کد تخفیف رخ داده است."),$("#btnSaveDiscountCodeValue").fadeOut(0),$("#btnRemoveDiscountCodeValue").fadeIn()}}else $(".couponReportWarper").fadeOut(),$("#btnRemoveDiscountCodeValue").fadeOut(0),$("#btnSaveDiscountCodeValue").fadeIn(),$("#discountCodeValue").val(""),t(n.price.final),d([]),!0===e&&toastr.success("کد تخفیف شما حذف شد.");mApp.unblock(".discountCodeValueWarper, .hasntDiscountCodeWraper")},error:function(e,n,t){mApp.unblock(".discountCodeValueWarper, .hasntDiscountCodeWraper")}})}function d(e){var n="";if(null!=e&&""!==e&&e.length>0){for(var t in n+='<div class="m-alert m-alert--icon m-alert--icon-solid m-alert--outline alert alert-warning alert-dismissible fade show" role="alert">\n  <div class="m-alert__icon">\n    <i class="flaticon-exclamation"></i>\n    <span></span>\n  </div>\n  <div class="m-alert__text">\n    <strong>توجه!</strong> کد تخفیف وارد شده شامل محصولات زیر نمی شود:\n  </div>\n  <div class="m-alert__close">\n  </div>\n</div><div class="row">',e){n+='<div class="col">  <div class="alert alert-accent alert-dismissible fade show m-alert m-alert--square m-alert--air notIncludedProductsInCoupon" role="alert">\n    <div>'+e[t].name+"    </div>  </div></div>"}n+="</div>"}$(".notIncludedProductsInCouponReportArea").html(n)}return{refreshUi:function(){e=!0,n=!0,o(),c(),u(),e=!1,n=!1},refreshUiBasedOnHasntDiscountCodeStatus:function(){u()},refreshUiBasedOnPaymentType:function(){o()},refreshUiBasedOnDonateStatus:function(e){c()},attachCoupon:function(){var e;0===(e=$("#discountCodeValue").val()).trim().length?toastr.warning("مقداری برای کد تخفیف وارد نشده است."):!n&&(mApp.block(".discountCodeValueWarper, .hasntDiscountCodeWraper",{type:"loader",state:"info"}),$.ajax({type:"POST",url:$("#OrderController-submitCoupon").val(),data:{code:e},success:function(e){if(e.error)$("#btnRemoveDiscountCodeValue").fadeOut(0),$("#btnSaveDiscountCodeValue").fadeIn(),toastr.warning("کد وارد شده معتبر نیست.");else{$(".couponReportWarper").fadeIn();var n=" کپن تخفیف  <strong>"+e.coupon.name+"</strong>  ("+e.coupon.code+")  با "+e.coupon.discount;"percentage"===e.coupon.discountType.name?n+="% تخفیف برای سفارش شما ثبت شده است.":"cost"===e.coupon.discountType.name&&(n+=" تومان تخفیف برای سفارش شما ثبت شد. "),$(".couponReport").html(n),$("#btnSaveDiscountCodeValue").fadeOut(0),$("#btnRemoveDiscountCodeValue").fadeIn(),t(e.price.final),d(e.notIncludedProductsInCoupon),toastr.success("کد تخفیف شما ثبت شد.")}mApp.unblock(".discountCodeValueWarper, .hasntDiscountCodeWraper")},error:function(e,n,t){var o="";o=500==e.status?"خطایی رخ داده است.":"کد وارد شده معتبر نیست",toastr.warning(o),mApp.unblock(".discountCodeValueWarper, .hasntDiscountCodeWraper")}}))},detachCoupon:function(e){s(e)},PrintnotIncludedProductsInCoupon:function(e){d(e)}}}(),lockDonateAjaxForSliderInit=!0;jQuery(document).ready(function(){var e=document.getElementById("m_nouislider_1_input"),n=document.getElementById("m_nouislider_1");CheckoutPaymentUi.refreshUi(),$(document).on("click","#btnSaveDiscountCodeValue",function(){CheckoutPaymentUi.attachCoupon()}),$(document).on("click","#btnRemoveDiscountCodeValue",function(){CheckoutPaymentUi.detachCoupon(!0)}),$(document).on("change",'input[type="radio"][name="radioPaymentType"]',function(){CheckoutPaymentUi.refreshUiBasedOnPaymentType()}),$(document).on("switchChange.bootstrapSwitch","#hasntDiscountCode",function(){CheckoutPaymentUi.refreshUiBasedOnHasntDiscountCodeStatus()}),$(document).on("switchChange.bootstrapSwitch","#hasntDonate",function(e){CheckoutPaymentUi.refreshUiBasedOnDonateStatus($("#m_nouislider_1_input").val())}),noUiSlider.create(n,{start:[5],connect:[!0,!1],step:1,range:{min:[1],max:[50]},format:wNumb({decimals:0})}),n.noUiSlider.on("update",function(n,t){e.value=n[t],lockDonateAjaxForSliderInit||CheckoutPaymentUi.refreshUiBasedOnDonateStatus(e.value),lockDonateAjaxForSliderInit=!1}),e.addEventListener("change",function(){n.noUiSlider.set(this.value)})});
