(function(a,b){if(typeof define==="function"&&define.amd){define([],b.bind(this,a,a.videojs))}else{if(typeof module!=="undefined"&&module.exports){module.exports=b(a,a.videojs)}else{b(a,a.videojs)}}})(window,function(c,b){c.videojs_pip={version:"0.3"};var a=function(m){var l=this;var f=l.el();var g=d("vjs-control-bar",f);var k=c.getComputedStyle(g,null).getPropertyValue("height");k=(parseInt(k)-3)+"px";var h={title:"",url:"",src:"",start:0,loop:true,redirect:false,piptitle:"Coming Next...",watchtitle:"Watch Now...",offset:30};var e=b.mergeOptions||b.util.mergeOptions;m=e(h,m||{});a.element;a.firstplay=false;a.waspip=false;a.possible=true;a.vario="dargre";function j(o){var n=document.head||document.getElementsByTagName("head")[0];var p=document.createElement("style");p.type="text/css";if(p.styleSheet){p.styleSheet.cssText=o}else{p.appendChild(document.createTextNode(o))}n.appendChild(p)}function d(t,p){if(!p){p=document}try{if(document.getElementsByClassName){return p.getElementsByClassName(t)[0]}else{var s=p.getElementsByTagName("*"),o=s.length,n=[],r=0,q;for(r;r<o;r+=1){q=s[r];if(q.className.search(t)!==-1){n.push(q)}}return n[0]}}catch(u){}return false}var i=".video-js .vjs-pip-trans {bottom:"+k+";opacity:0;-khtml-opacity:0;-webkit-transition: all 0.3s;-moz-transition: all 0.3s;-o-transition: all 0.3s;-ms-transition: all 0.3s;transition: all 0.3s;}";j(i);l.on("ready",function(){l.on("timeupdate",function(){if(m.url!=""&&m.src!=""&&a.waspip!=true){if(l.currentTime()>(l.duration()-m.offset)){a.waspip=true;var n=f.offsetWidth;a.element=document.createElement("div");if(n<480){a.element.className="vjs-pip"}else{a.element.className="vjs-pip vjs-pip-trans"}a.videocontainer=document.createElement("div");a.videocontainer.className="pip-video-el";a.html='<div class="vjs-piptitle"><span>'+m.piptitle+'</span><div class="vjs-pipclose">x</div></div>';a.vid=document.createElement("video");if(m.start>0){m.src=m.src+"#t="+m.start}a.vid.src=m.src;a.vid.muted=true;a.vid.preload="auto";a.vid.autoplay="autoplay";if(m.loop){a.vid.loop=true}a.element.innerHTML=a.html;a.element.appendChild(a.videocontainer);a.videocontainer.appendChild(a.vid);if(m.title!=""){a.vidtitle=document.createElement("div");a.vidtitle.className="vjs-vid-title";a.vidtitle.innerHTML=m.title;a.videocontainer.appendChild(a.vidtitle)}a.watchnow=document.createElement("a");a.watchnow.className="vjs-watch-now";a.watchnow.innerHTML=m.watchtitle;a.watchnow.href=m.url;a.watchnow.target="_blank";a.videocontainer.appendChild(a.watchnow);f.appendChild(a.element);a.vid.onplaying=function(){if(a.firstplay!=true){a.firstplay=true;var o=f.offsetWidth;if(o<480){vid.pause()}else{a.element.className="vjs-pip vjs-pip-trans vjs-pip-show"}}};l.on("ended",function(){f.removeChild(a.element);a.possible=false;console.log("ended"+m.redirect);if(m.redirect){console.log("redirect");document.location=m.url}});a.close=d("vjs-pipclose",f);a.close.addEventListener("click",function(o){f.removeChild(a.element)});c.addEventListener("resize",function(){if(a.firstplay&&a.possible){var o=f.offsetWidth;if(o<480){a.element.className="vjs-pip";a.vid.pause()}else{a.element.className="vjs-pip vjs-pip-trans vjs-pip-show";a.vid.play()}}})}}})});return this};b.registerPlugin("pip",a)});